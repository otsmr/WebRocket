<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Websocket test</title>
</head>
<body>

    <p>Status: <span id="state">Disconnected</span></p>
    <select id="port">
        <option value="3001" selected>3001</option>
        <option value="8080">8080</option>
    </select>
    <button onclick="connect()">Connect</button>
    <button onclick="ping()">Ping</button>
    <button onclick="big()">BigMessage</button>
    <button onclick="closeSocket()">Close</button><br /><br />

    <textarea id="message" placeholder="Nachricht senden"></textarea> <br />
    <button onclick="send()" >Senden</button>


    <script>

        let socket = null;

        function closeSocket() {
            if (socket === null)
                return;
            state.innerText = "Disconnecting...";
            socket.close(); 
        }
        function big () {
            let message = "";
            let count = 0;
            for (let i = 0; i < 1000000; i++) {
                if ((i % 26) == 0 && i > 0) {
                    message += " (" + String(message.length) + ")\n";
                }
                message += String.fromCharCode((i) % 26 + 65)
            }
            console.log("Total length of message:", message.length);
            message += "\nTotal length of message: " + message.length + "\n";
            socket.send(message);
        }
        function ping () {
            socket.send("ping pöng");
            const i = setInterval(() => {
                socket.send("ping pöng");
            }, 1000);
    
            setTimeout(() => {
                clearInterval(i);
            }, 5000);
        }
        function send () {
            socket.send(message.value);
        }

        function connect () {
            state.innerText = "Connecting...";
            socket = new WebSocket('ws://localhost:' + port.value);

            socket.onerror = e => console.log("[ERROR]", e);
            socket.onmessage =  m => console.log("[MESSAGE]", m);
            socket.onclose = e => {
                state.innerText = "Disconnected";
                console.log("[CLOSED]", e.code);
                socket = null;
            };
            socket.onopen = _ => {
                state.innerText = "Connected";
            };  

        }

    </script>

</body></html>  